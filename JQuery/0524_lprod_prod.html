<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LPROD 2</title>
<link rel="stylesheet" href="../css/public_blue.css">
<link rel="shortcut icon" type="image/x-icon" href="../images/J.png"/>
<script src="../js/jquery-3.6.0.min.js" type="text/javascript"></script>
<script>
$(function(){
		
		xmlR = new XMLHttpRequest();
		
// 	$('input:button').on('click', function(){
	$('#btn1').on('click', function(){
		
		//요청
		xmlR.open('get', '../0523/lprod.jsp', true);
		xmlR.send();
		
		//응답
		xmlR.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200){
				res = JSON.parse(this.responseText);
				
				//lprod 상품 option 생성
				code = "";
				
				$.each(res, function(i, v){
					code += "<option value='" +res[i].gu + "'>" + res[i].nm + "</option>";
					
				})
				
				
				$('#lprod').html(code);
// 				$('#lprod').append(code);
			}
		}
		
	})
	
	//lprod 상품을 선택하면 option의 value 값(lprod_gu)을 서버로 보내서
	//lprod_gu 값을 파라미터로 하고, prod_lgu와 일치하는 의 상품 리스트 출력
	//$('this option') -> this는 따옴표 안에 들어갈 수 없기 때문에 
	//$('option:selected', this) 이렇게 바꿔줘야 함
	$('#lprod').on('change', function(){
		lguValue = $('option:selected', this).val();
		console.log(lguValue); // 잘 넘어오는지 콘솔에 찍어보기
		
//		location.href="prod.jsp?lgu=" + lguvalue; //동기방식 : 페이지가 넘어감
		
		//비동기방식 : 페이지가 넘어가지 않음
		//요청
		xmlR.open("get", "prod.jsp?lgu=" + lguValue, true);
		xmlR.send();
		
		//응답
		xmlR.onreadystatechange= function(){
			if(this.readyState == 4 && this.status == 200){
				res = JSON.parse(this.responseText);
				
				//option 생성
				code = "";
				
				$.each(res.data, function(i, v){
					code += "<option value='" +v.id + "'>" + res.data[i].name + "</option>";
					
				})
				
				
				$('#prod').html(code);
			}
		}
		
	})
	
})
</script>
</head>
<body>


<pre>
버튼 클릭 시 lprod의 정보를 출력
</pre>

<input type="button" value = "확인" id="btn1">
<br><br>
	<select id="lprod">
	
	</select>
	<select id="prod">
	
	</select>
<div id = "d1">
</div>

</body>
</html>
